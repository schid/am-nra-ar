YUI.add("videomodal",function(e,t){function n(){n.superclass.constructor.apply(this,arguments)}n.NAME="videomodal",n.ATTRS={},e.namespace("Vdgm").VideoModal=e.Base.create("videomodal",e.Widget,[e.WidgetChild],{MODAL_DURATION:8,VIDEO_PAUSED_EVENT:"video_paused",VIDEO_ENDED_EVENT:"video_ended",TRIGGER_VIDEO_STOP:"video_player_stop",TRIGGER_VIDEO_PLAY:"video_player_play",BOUNDING_TEMPLATE:'<div id="video-modal"/>',CONTENT_TEMPLATE:'<div class="video-headline now-playing">NOW PLAYING</div><div class="video-headline related-videos-headline">RELATED VIDEOS</div><div class="video-paused play-video"><p class="video-headline vdgm-icon-pause icon-pause"></p></div><div id="video-timer-message"><p>NEXT VIDEO WILL BEGIN IN: <span id="video-timer"></span></p></div><div id="video-modal-control"><div id="control-buttons"><div class="control"><div id="play-video-control" class="video-control-button play-video"></div></div><div class="control"><div id="close-video-control" class="video-control-button stop-video"><span class="vdgm-icon-stop icon-stop" ></span></div></div><div class="control"><div id="next-video-control" class="video-control-button next-video">Play Next Video</div></div></div><div id="share-items"><p>SHARE</p><div id="facebook-video-control" class="vdgm-shareable"><span class="vdgm-icon-facebook icon-facebook" ></span></div><div id="twitter-video-control" class="vdgm-shareable"><span class="vdgm-icon-twitter icon-twitter" ></span></div><div id="email-video-control" class="vdgm-shareable"><span class="vdgm-icon-share icon-share"></span></div></div></div>',templates:{LIST:'<ul class="related-videos"></ul>',LINK:"://{host}/home/video/{slug}",RELATED_ITEM:'<li data-itemslug="{slug}" class="related-video related-video-{index}"><a href="{link}" target="{target}"><div class ="list-item-image"><img  src="{imageURL}"/><p>{title}</p></div></a></li>',REPLAY_BUTTON:'<span class="vdgm-icon-spinner icon-spinner"></span>',PLAY_BUTTON:'<span class="vdgm-icon-play icon-play"></span>'},relatedGroups:[],selectors:{relatedVideoItem:".related-video",lastRelatedItem:".lastRelatedItem",prev:".video-prev",next:".video-next",modal:"#video-modal",playButton:"#play-video-control",playClass:"play-video",stopClass:"stop-video",closeButton:"#close-video-control",pausedHeadline:".video-paused",relatedVideos:".related-videos",relatedVideoContainer:"#related-video-container",timer:"#video-timer",embed:"#embed-player"},events:{".play-video":{click:"handleControlClick"},".stop-video":{click:"handleControlClick"},".next-video":{click:"playNextVideo"}},_closeAfterEnded:!0,_hasShareItems:!0,initializer:function(e){var t=this,n=t.get("boundingBox");e.closeAfterEnded?t._closeAfterEnded=e._closeAfterEnded:this.get("boundingBox").addClass("no-close"),e.hasShareItems||this.get("boundingBox").addClass("no-share"),e.hasStopButton||this.get("boundingBox").addClass("no-stop"),this.on("parentChange",function(n){console.log(n+" "+n.parent),t._parent=n.newVal,t.initEvents(e)});for(var r in this.events)for(var i in t.events[r])n.delegate(i,t[t.events[r][i]],r,this)},initEvents:function(e){var t=this;container=t.get("boundingBox"),t._parent.after("pause",function(n){t._handleModal(e,t.VIDEO_PAUSED_EVENT),t._initRelated(e,t.VIDEO_PAUSED_EVENT)}),t._parent.after("stop",function(e){t.get("boundingBox").remove(),t._parent.remove(this)}),t._parent.after("ended",function(n){t._handleModal(e,t.VIDEO_ENDED_EVENT),t._initRelated(e,t.VIDEO_ENDED_EVENT)}),t._parent.after("play",function(e){t.get("boundingBox").removeClass("active"),t.get("boundingBox").ancestor().removeClass("modal-control-active")})},setZero:function(e){return e<0?0:e},cycleItems:function(t){if(t=="fwd"&&this.currentGroup+1==this.relatedGroups.length||t=="back"&&this.currentGroup-1==-1)return;var n=this;itemIndex=0,container=e.one(n.selectors.modal),relatedVideoList=container.one(n.selectors.relatedVideos),nextGroup=n.relatedGroups[t==="fwd"?n.currentGroup+1:n.setZero(n.currentGroup-1)],nextIndex=t==="fwd"?n.currentGroup+1:n.setZero(n.currentGroup-1),nextIndex>=0&&!n.transitioning&&(n._repetition=8,n.transitioning=!0,n.relatedGroups[n.currentGroup].hide("fadeOut",{},function(){nextGroup.show("fadeIn",{},function(){n.currentGroup=nextIndex,n.transitioning=!1})}))},_initRelated:function(t,n){var r=this._parent.model.related_videos,i=this,s=this.get("boundingBox").ancestor(),o=this.get("boundingBox"),u=0,a=0,f=e.Node.create(this.templates.LIST),l="",c={},h={};i.transitioning=!1,i.totalGroups=0,i.maxRelated=Math.floor(o.get("offsetWidth")/210),this.embed=this._parent.model.embed;if(!r){s.one(".related-videos-headline").addClass("hide"),s.one("#next-video-control").addClass("hide"),s.one("#video-timer-message").addClass("hide");return}for(var p=0;p<Number(r.length);p++){u=p,l=r[u].link?r[u].link:e.Lang.sub(i.templates.LINK,{host:t.host,slug:r[u].slug}),subcfg={slug:r[u].slug,index:u,link:l,imageURL:i._getThumbImage(r[u]),target:i.embed?"_blank":"_self",title:r[u].title};var c=e.Lang.sub(i.templates.RELATED_ITEM,subcfg),d=e.Node.create(c);p||(i.firstRelated=d),f.appendChild(d)}if(!i.get("boundingBox").one(i.selectors.relatedVideos)){i.get("boundingBox").appendChild(f);var v=i.get("boundingBox").one(i.selectors.relatedVideos).getDOMNode(),m=jQuery(v);m.perfectScrollbar({wheelPropagation:!0})}},_getThumbImage:function(e){var t,n=this;return e.images&&e.images[285]?t=e.images[285].imageUrl:t=e.images[263]?e.images[263].imageUrl:"",t},_handleModal:function(e,t){if(this.get("boundingBox").hasClass("active"))return;var n=this.get("boundingBox").ancestor(),r=this,i=this._parent.model,s=this.get("boundingBox"),o=this.get("boundingBox").one(r.selectors.playButton),u=this.get("boundingBox").one(r.selectors.closeButton),a={};r.type=t,this.get("boundingBox").ancestor().addClass("modal-control-active"),r.type&&(this.get("boundingBox").removeClass("video_paused"),this.get("boundingBox").removeClass("video_ended"),this.get("boundingBox").addClass(r.type)),r._repetition=r.MODAL_DURATION,r.type===r.VIDEO_PAUSED_EVENT?
(o.setHTML(r.templates.PLAY_BUTTON),r.isPaused=!0):r.type===r.VIDEO_ENDED_EVENT&&(o.setHTML(r.templates.REPLAY_BUTTON),i.related_videos&&r._setTimer()),r.fbShare=s.one("#facebook-video-control"),r.fbShare.setAttribute("data-shareid","facebook:video:"+i.id),r.twitterShare=s.one("#twitter-video-control"),r.twitterShare.setAttribute("data-shareid","twitter:video:"+i.id),r.emailShare=s.one("#email-video-control"),r.emailShare.setAttribute("data-shareid","email:video:"+i.id),this.get("boundingBox").addClass("active")},handleControlClick:function(e){var t=this,n=t.get("boundingBox");control=e.currentTarget;if(control.hasClass(t.selectors.playClass))t.type===t.VIDEO_ENDED_EVENT&&(t._repetition=t.MODAL_DURATION,window.clearInterval(t.interval)),t._parent.play();else if(control.hasClass(t.selectors.stopClass)){t._parent.stop(),window.clearInterval(t.interval);return}n.removeClass("active")},playNextVideo:function(e){this.firstRelated.one("a").simulate("click")},closeModal:function(){var e=this;e.get("boundingBox").removeClass("active")},related:{},_setCurrentTime:function(e){var t=this._swf.getDOMNode();t.setCurrentTime(e)},_handleTimer:function(){var e=this,t=this.get("boundingBox"),n=t.one(e.selectors.timer);e._repetition>0?(e._repetition=e._repetition-1,n.setHTML(e._repetition)):(window.clearInterval(e.interval),e.playNextVideo(),e._repetition=e.MODAL_DURATION)},_repetition:0,_setTimer:function(){var e=this;e.interval=window.setInterval(function(){e._handleTimer()},1e3)}}),e.Vdgm.app&&e.augment(n,e.Vdgm.Logger)},"0.0.1",{requires:["node-event-html5","widget","vdgm-logr","event-synthetic","widget-child"],skinnable:!0});
